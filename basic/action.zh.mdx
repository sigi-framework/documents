---
name: Action
route: /zh/basic/action
menu: åŸºæœ¬æ¦‚å¿µ
---

# Action

Sigi çš„ `EffectModule` åº•å±‚ç”±ä¸€ä¸ªåä¸º `State` çš„å¯¹è±¡å®ç°ã€‚`State` å¯¹è±¡å’Œ `Redux` çš„ `Store` éå¸¸ç±»ä¼¼ã€‚å®ƒæ€»æ˜¯æ¥æ”¶ä» `Dispatcher` å’Œ `Effect` å‘é€è¿‡æ¥çš„ `Action`, å¹¶ä¸”å°†å®ƒä»¬ä¼ é€’ç»™ `Reducer` å’Œ `Effect`ã€‚

åœ¨ä½¿ç”¨ Sigi çš„åº”ç”¨ä¸­ï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»º `Action`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹å¤–æä¾› `Dispatch` æ–¹æ³•ã€‚å–è€Œä»£ä¹‹æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è¾¾åˆ° `Dispatch` action çš„æ•ˆæœ:

- è°ƒç”¨ **Dispatcher** ä¸Šçš„æ–¹æ³•
- åœ¨ **Effect** ä¸­å‘å°„ (emit) action

## Dispatcher & ActionsCreator

**Dispatcher** æ˜¯ä¸€ä¸ªåŒ…å«ä¸°å¯Œç±»å‹å®šä¹‰çš„ **ActionsCreator** çš„æŠ½è±¡ã€‚
æ‰€æœ‰ `EffectModule` ç±»ä¸Šè¢« **Reducer**, **ImmerReducer**, **Effect** å’Œ **DefineAction** è£…é¥°å™¨è£…é¥°çš„æ–¹æ³•ï¼Œéƒ½åœ¨ `EffectModule` ç±»ä¸­çš„ **ActionsCreator** å¯¹è±¡ä¸Šæœ‰ä¸€ä¸ªå¯¹åº”çš„æ–¹æ³•ï¼Œä¹Ÿåœ¨ `Component` ä¸­çš„ **Dispatcher** ä¸Šæœ‰ä¸€ä¸ªå¯¹åº”çš„æ–¹æ³•ã€‚`EffectModule` ç±»ä¸­çš„ **ActionsCreator** ç”¨æ¥ç”Ÿæˆä¸€ä¸ª `Action` å¹¶ä¸”å‘å°„(emit) ç»™ `State` å¯¹è±¡ï¼Œ`Component` ä¸­çš„ **Dispatcher** ç”¨æ¥ç›´æ¥ `Dispatch` ä¸€ä¸ª Action ç»™ `State` å¯¹è±¡ã€‚

### Dispatch props created by Redux-Actions

ä½ å¯èƒ½åœ¨å†™ `Redux` çš„æ—¶å€™ç”¨è¿‡ [Redux-Actions](https://github.com/redux-utilities/redux-actions) è¿™ä¸ªåº“ã€‚`Sigi` ä¸­çš„ **ActionsCreator** æ¦‚å¿µä¸ `Redux-Actions` åº“ä¸­çš„ **ActionsCreator** éå¸¸ç±»ä¼¼ã€‚åœ¨ `Redux` åº”ç”¨ä¸­ **ActionsCreator** æœ‰å‡ ä¸ªæ˜æ˜¾çš„å¥½å¤„:

- é¿å…åœ¨ç¨‹åºä¸­ç¼–å†™ [é­”æ³•å­—ç¬¦ä¸²](<https://en.wikipedia.org/wiki/Magic_number_(programming)>)
- (åœ¨ TypeScript åº”ç”¨ä¸­)æä¾›ç±»å‹ä¿¡æ¯
- å‡å°‘æ ·æ¿ä»£ç 

ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†åœ¨ `Redux` åº”ç”¨ä¸­ä½¿ç”¨å’Œä¸ä½¿ç”¨ `Redux-Actions` çš„åŒºåˆ«:

```typescript
// raw dispatcher
connect(mapStateToProps, (dispatch) => bindActionCreators({
  addCount: (count: number) => dispatch({ // losing type information here
    type: 'ADD_COUNT',
    payload: count,
  }),
}, dispatch))

// reducer
export const reducer = (state, action) => { // losing type information here
  switch action.type:
    case: 'ADD_COUNT':
      return { ...state, count: state.count + payload }
    default:
      return { count: 0 }
}
```

```typescript
const ADD_COUNT = createAction<number>("ADD_COUNT");

interface DispatchProps {
  addOne: typeof ADD_COUNT;
}

interface StateProps {
  count: number;
}

// react actions dispatcher
connect(mapStateToProps, (dispatch) =>
  bindActionCreators(
    {
      addCount: ADD_COUNT,
    } as DispatchProps,
    dispatch
  )
);

// reducer
export const reducer = handleActions(
  {
    [`${ADD_COUNT}`]: (state: StateProps, { payload }: Action<number>) => {
      return { ...state, count: state.count + payload };
    },
  },
  { count: 0 }
);
```

### ä½¿ç”¨ Sigi ç®¡ç† actions

#### å®šä¹‰ EffectModule

```ts
import { Module, EffectModule, Reducer } from "@sigi/core";
interface State {
  count: number;
}

@Module("SomeNamespace")
class SomeModule extends EffectModule<State> {
  defaultState = {
    count: 0,
  };

  @Reducer()
  add(state: State, count: number) {
    return { ...state, count: state.count + count };
  }
}
```

> å¯ä»¥ä»ä¸Šé¢çš„ä»£ç çœ‹åˆ°ï¼Œæ²¡æœ‰ä»»ä½•é­”æ³•å­—ç¬¦ä¸²ï¼Œä¹Ÿæ²¡æœ‰å†—ä½™çš„æ ·æ¿ä»£ç  ğŸ¤¯ã€‚

#### ä½¿ç”¨

å¯¹ä½¿ç”¨ React å¼€å‘çš„åº”ç”¨ï¼Œæˆ‘ä»¬æä¾›äº†ä¸¤ä¸ª hooks æ¥åœ¨ç»„ä»¶ä¸­å¼•ç”¨ effect module é‡Œå®šä¹‰çš„æ“ä½œã€‚
è¿™ä¸¤ä¸ª hooks éƒ½æ¥æ”¶ EffectModule ç±»å‹ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å› Module å¯¹äºçš„ dispatcher

#### `useModule` å’Œ `useDispatchers`

```ts
// ä½¿ç”¨ module
import { useDispatchers, useModule } from "@sigi/react";

const SomeComponent = () => {
  // æ³¨æ„ï¼šæˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒ dispatcher çš„ç±»å‹ã€‚
  // Sigi çš„ç±»å‹ç³»ç»Ÿå¯ä»¥ä¿è¯æ‰€æœ‰å®šä¹‰åœ¨ module ä¸­çš„ reducers/effects çš„ç±»å‹éƒ½èƒ½ 100% æ­£ç¡®åœ°è¢«æ¨å¯¼å‡ºæ¥ã€‚
  const [state, dispatcher] = useModule(SomeModule);
  // å¦‚æœæŸä¸ªç»„ä»¶ä¸å…³å¿ƒ module çš„çŠ¶æ€å˜æ›´ï¼ˆå³ä¾¿çŠ¶æ€æ›´æ–°äº†ï¼Œä¹Ÿä¸éœ€è¦é‡æ–°æ¸²æŸ“ï¼‰ï¼Œå¯ä»¥è¿™ä¹ˆä½¿ç”¨ï¼š
  // const dispatcher = useDispatchers(SomeModule);

  const onClickAdd = useCallback(() => {
    // ts ä¼šå¯¹ payload è¿›è¡Œç±»å‹æ£€æŸ¥
    // ä¹Ÿå¯ä»¥ç›´æ¥åœ¨è¿™é‡Œä½¿ç”¨**è·³è½¬åˆ°å®šä¹‰**ç±»ä¼¼çš„ç¼–è¾‘å™¨åŠŸèƒ½ï¼
    dispatcher.add(1);
    // ä¸‹é¢è¿™è¡Œä¼šå‡ºç° ts ç±»å‹é”™è¯¯
    // dispatch.add('string value');
  }, [dispatcher]);

  return (
    <div>
      <button onClick={onClickAdd}>add 1</button>
      <span>count: {state.count}</span>
    </div>
  );
};
```
